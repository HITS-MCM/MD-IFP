# MD-IFP: MD trajectory analysis using protein-ligand Interaction Fingerprints
## A Python workflow for generation and analysis Protein-Ligand Interaction Fingerprints from Molecular Dynamics tajectories
## v.1.0

__Authors:__

* Daria Kokh
* Fabian Ormersbach - preprocessing PDB files using Chimera (Process_pdb.py, chimera_hydrogen_mol2.py; test examples revised) 


Daria.Kokh@h-its.org

Heidelberg Institute of Theoretical Studies (HITS, www.h-its.org)

Schloss-Wolfsbrunnenweg 35

69118 Heidelberg, Germany
    

*This open source software code was developed in part in the __Human Brain Project__, funded from the European Unionâ€™s Horizon 2020 Framework Programme for Research and Innovation under Specific Grant Agreements  No. 785907 (Human Brain Project  SGA2).*


# __Important notes regarding the file preparation procedure for IFP computations:__

## Ligand structure
  1. __Ligand must be protonated__. For analysis of multiple structures, one can use the automated procedure implemented in the script Process_pdb.py that employs the Chimera software (https://www.cgl.ucsf.edu/chimera/). 
  2. The ligand structure should be provided as a  __MOL2 file__. However, not all mol2 formats are accepted by RDKit (the Python library that is used to determine ligand atom properties). The main problem with mol2 files generated by Chimera is that it often incorrectly describes bonds in aromatic or cyclic groups that contain nitrogen atoms. The mol2 file generated can in some cases be corrected by using http://www.swissparam.ch/. The best way to generate a mol2 file is to use the MOE or Maestro software.
  3. If mol2 file is absent or is not accepted by RDKit, pdb file will be used to define properies of ligand atoms. Unfortunately, in this case aromatic fragments will not be identified.
  4. There are several atom properties that are introduced in addition to those identified by RDKit:
      - Hydrophobic properties of fluorine atoms
      -  Negative ion property of the phosphate atom
      -  Acceptor property of the oxygen atoms bound to phosphorus atoms in phosphate groups
  5. __Important__, the name of the ligand in mol2 file (or the residue name in the pdb file if mol2 is absent) is used to detect ligand in a trajectory or in a complex. If the residue name is different - IFP will not be computed!
  
 ## Complex structure/trajectory 
   1. __System (protein/ligand/water) must be protonated__. This is nessesary for detection of hydrogen bonds.
   2. __Finding ligand contacts with ions/RNA/etc__.To minimize the memory and computational time required, only a part of the system is analyzed (defined by a variable sub_system). By default, this is protein+water+ligand. Interactions (H-bonds) with DNA/RNA and ions can be found only if their residues are explicitly defined in by the sub_system variable of the trajectories class. Alternatively, one can speed-up computqtions by keeping only protein as a sub_system. For example:
     
     # by default protein, ligand and water are considered
     # consider only protein and ligand 
     tr = trajectories()
     tr.sub_system = " proteins "
     tr.analysis_all_namd()
     
     # consider only protein, water, ligand, RRN, and some ions
     tr = trajectories()
     tr.sub_system = "protein or (resname G G3 G5 U5 C C3 MG MN CA Mg Mn) or (resname WAT HOH SOL)"
     tr.analysis_all_namd()

   
   3. For computation of IFP in a trajectory, protein (reference) structure in a pdb format must be provided in addition to a trajectory file. It must have the same structure. Note, that RMSD computed will be relative to the reference structure (not the first frame).
   4. Currently, Gromacs trajectories (as xtc) must be pre-processed in order to build back molecules that can be splitted due to the motion under PBC. Trajectory analysis does not do this properly (to be fixed in future) One can use the following command:
   
    gmx trjconv -f ramd_trj.xtc  -s ramd_tpr.tpr  -pbc mol -o ramd_trj_fixed.xtc  <<< 0
    or to save only starting from 500ps:
    gmx trjconv -f ramd_trj.xtc  -s ramd_tpr.tpr  -pbc mol -o ramd_trj_fixed.xtc  -b + 500 <<< 0
    
   
   
 # __Structure of the MD-IFP library:__

## A set of  Python scripts  collected in the directory Scripts

   1. Trajectories.py
   2. IFP_generation.py
   3. Clustering.py
   
  

